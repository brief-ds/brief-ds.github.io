/---
title: Apollo Guidance Computer fixed-width arithmetic
layout: post
---

## Introduction to the Apollo Guidance Computer
Apollo Guidance Computer was a digital computer produced for the Apollo program. The [command module](https://en.wikipedia.org/wiki/Apollo_command_and_service_module) flies to the moon orbit. The [lunar module](https://en.wikipedia.org/wiki/Apollo_Lunar_Module) then descends to the moon and makes way back to the command module.

The [Virtual AGC](https://ibiblio.org/apollo/) was a project started in 2003 by volunteers and took about 20 years to restore the software line by line into digital form. I can hardly find an adjective to properly describe the amount of effort invovled.

The [Colossus](https://ibiblio.org/apollo/Colossus.html) software runs on the command module and the [Luminary](https://ibiblio.org/apollo/Luminary.html) software runs on the lunar module. There is another significant [Abort Guidance System](https://ibiblio.org/apollo/yaAGS.html) as a backup computer system, made by a different company, different team of people, only using common hardware technology then.

The processing logic was integrated with other components. It runs at roughly the same speed as the access to memory. It is programmed by an assembly language. An interpreter is also implemented. The interpreter language can even manage virtual memory and do matrix-vector multiplication.

The operating system is real-time, consisting of one co-operative scheduler and one interrupt-driven pre-emptive scheduler. The pre-emptive scheduler famously cleaned out low priority routines from memory when the processing logic was too busy.

## Fixed-width arithmetic
The Apollo Guidance Computer only does integer multiplication and division. So how were [trigonometric functions](https://en.wikipedia.org/wiki/Trigonometry) computed, essential to space flight, which usually require [real numbers](https://www.mathisfun.com/numbers/real-numbers.html)?

It makes approximation with polynomials as does [Taylor series expansion](https://en.wikipedia.org/wiki/Taylor_series).

For precise information, search for documents entitled  "Guidance Equations" in the [AGC Document Library](https://www.ibiblio.org/apollo/links.html) for various Apollo flights.

### Multiplication
How does it calculate an item of multiplication in the above polynomial? The programmer has to remember the decimal point is at the start of the fractional part. The fractional part is stored as a 15-bit integer. A 15-bit fractional number is "single-width". A 30-bit fractional number is "double-width". Note multiplying two single-width fractional numbers would yield a double-width fractional number.

Below we explain how two double-width fractional numbers got multiplied in Luminary099, the version that flew Apollo 11 the first man-landing mission. The code is the DMPSUB routine called by trigonometric function routines. Go to [https://www.ibiblio.org/apollo/Luminary.html](https://www.ibiblio.org/apollo/Luminary.html), in the version table find "Apollo 11", version "099/1", click on the "syntax-highlighted, hyperlinked HTML". On the home page for the version 099, scroll down, find the symbol "DMPSUB" in the SymbolTable, and click on it.

```
                     A_major  A_minor
                     B_major  B_minor
--------------------------------------
                     A_minor x B_minor
           A_major x B_minor   zeros
           B_major x A_minor   zeros
 A_major x B_major    zeros    zeros
```

```
DMPSUB    INDEX   ADDRWD
          CA      1
          TS      MPAC     +2
          CAF     ZERO
          XCH     MPAC     +1
          TS      MPTEMP
          EXTEND
          MP      MPAC     +2

          XCH     MPAC     +2
          EXTEND
          MP      MPAC
          DAS     MPAC     +1

          INDEX   ADDRWD
          CA      0
          XCH     MPTEMP
DMPSUB2   EXTEND
          MP      MPTEMP
          DAS     MPAC     +1

          XCH     MPAC
          EXTEND
          MP      MPTEMP
          DAS     MPAC
          TC      Q
```


## References
Apollo Guidance Computer, [https://en.wikipedia.org/wiki/Apollo_Guidance_Computer](https://en.wikipedia.org/wiki/Apollo_Guidance_Computer)

Virtual AGC Assembly-Language Manual, [https://ibiblio.org/apollo/assembly_language_manual.html](https://ibiblio.org/apollo/assembly_language_manual.html)

Virtual AGC Document Library, [https://www.ibiblio.org/apollo/links.html](https://www.ibiblio.org/apollo/links.html)

