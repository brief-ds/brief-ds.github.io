---
title: ARM64 function calls
layout: post
---

This article accompanies Lesson 10 Function Calls and Lesson 11 Stack Operations of the [ARM64 assembly tutorial](https://www.youtube.com/playlist?list=PLn_It163He32Ujm-l_czgEBhbJjOUgFhg) of LaurieWired.

ARM64's stack is [16-bytes aligned](https://hrishim.github.io/llvl_prog1_book/stack.html), so 64-bit registers got stored in pair, or some gap in the stack is left. Refer to the [The first ARM64 assembly program](/2025/07/13/first-arm64-code.html) for how to call Linux (for ARM64) `exit()` to end execution.

## Function call with stack operation
For what `[sp, #-16]!` does etc, refer to [Aarch64 addressing mode](https://devblogs.microsoft.com/oldnewthing/20220728-00/?p=106912).

`func.s`:

```asm
.global _start

_start:
    mov x0, #1
    mov x1, #2

    stp x0, x1, [sp, #-16]!      // store pair x0 x1
                                 // store x0 to sp - 16
                                 // store x1 to sp - 8
                                 // and set sp to sp - 16
    bl add_nums
    ldp x0, x1, [sp], #16        // load pair x0 x1
                                 // load x0 from sp
                                 // load x1 from sp + 8
                                 // and set sp to sp + 16

    mov x8, #0x5d
    svc #0

add_nums:
    add x0, x0, x1
    ret
```

```sh
$ as -o func.o func.s
$ gcc -o func func.o -nostdlib -static
$ ./func; echo $?
1


```


## Generic prologue and clean-up code around function call




## References
ARM64 assembly tutorial, LaurieWired, [https://www.youtube.com/playlist?list=PLn_It163He32Ujm-l_czgEBhbJjOUgFhg](https://www.youtube.com/playlist?list=PLn_It163He32Ujm-l_czgEBhbJjOUgFhg).

Introduction to Aarch64 architecture, 8. The Stack, [https://hrishim.github.io/llvl_prog1_book/stack.html](https://hrishim.github.io/llvl_prog1_book/stack.html).

Aarch64 part 3: addressing mode, [https://devblogs.microsoft.com/oldnewthing/20220728-00/?p=106912](https://devblogs.microsoft.com/oldnewthing/20220728-00/?p=106912).

Aarch64 part 24: code walkthrough, [https://devblogs.microsoft.com/oldnewthing/20220829-00/?p=107066](https://devblogs.microsoft.com/oldnewthing/20220829-00/?p=107066)

First ARM64 assembly program, [/2025/07/13/first-arm64-code.html](/2025/07/13/first-arm64-code.html).

Arm Compiler armasm User Guide. On [https://developer.arm.com](https://developer.arm.com), search for "armasm user guide". In the result list, find the latest version of "Arm Compiler armasm User Guide".
